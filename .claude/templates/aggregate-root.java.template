package {{package}}.model.aggregate;

import {{package}}.model.valueobject.{{name}}Id;
import solid.humank.genaidemo.domain.common.model.AggregateRoot;
import solid.humank.genaidemo.annotation.ddd.AggregateRoot as AggregateRootAnnotation;

import java.time.LocalDateTime;
import java.util.Objects;

/**
 * {{name}} Aggregate Root
 *
 * @author Generated by Claude Code (Kiro-compliant)
 * @version 1.0.0
 * @since 2025-11-16
 */
@AggregateRootAnnotation
public class {{name}} extends AggregateRoot<{{name}}Id> {

    {{#attributes}}
    private {{type}} {{name}};
    {{/attributes}}
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;

    /**
     * Private constructor for aggregate creation
     * Use factory method create() instead
     */
    private {{name}}({{name}}Id id{{#attributes}}, {{type}} {{name}}{{/attributes}}) {
        super(id);
        {{#attributes}}
        this.{{name}} = Objects.requireNonNull({{name}}, "{{name}} cannot be null");
        {{/attributes}}
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();

        // Register creation event
        registerEvent(new {{name}}CreatedEvent(
            id,
            {{#attributes}}{{name}},{{/attributes}}
            createdAt
        ));
    }

    /**
     * Factory method to create new {{name}}
     */
    public static {{name}} create({{name}}Id id{{#attributes}}, {{type}} {{name}}{{/attributes}}) {
        return new {{name}}(id{{#attributes}}, {{name}}{{/attributes}});
    }

    {{#methods}}
    /**
     * {{description}}
     */
    public void {{name}}({{#parameters}}{{type}} {{name}}{{^last}}, {{/last}}{{/parameters}}) {
        // Business rule validation
        validateBusinessRules();

        // Update state
        {{#stateChanges}}
        this.{{field}} = {{value}};
        {{/stateChanges}}
        this.updatedAt = LocalDateTime.now();

        // Register domain event
        registerEvent(new {{eventName}}(
            this.getId(),
            {{#eventAttributes}}{{name}}{{^last}},{{/last}}{{/eventAttributes}},
            updatedAt
        ));
    }
    {{/methods}}

    /**
     * Validate business rules
     */
    private void validateBusinessRules() {
        // Add business rule validations here
    }

    // Getters (immutable)
    {{#attributes}}
    public {{type}} get{{nameCapitalized}}() {
        return {{name}};
    }
    {{/attributes}}

    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    public LocalDateTime getUpdatedAt() {
        return updatedAt;
    }
}
